<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ADVANCED ENCRYPTION BREAK</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
    height:100vh;
    background: radial-gradient(ellipse at top, #00110a, #000000);
    font-family:'Share Tech Mono', monospace;
    color:#00ff66;
    display:flex;
    justify-content:center;
    align-items:center;
    overflow:hidden;
    position:relative;
}
.grid-bg{
    position:fixed;
    inset:0;
    background-image:
        linear-gradient(rgba(0,255,102,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0,255,102,0.03) 1px, transparent 1px);
    background-size:50px 50px;
}
.scanner{
    position:fixed;
    top:-4px;
    left:0;
    width:100%;
    height:4px;
    background:linear-gradient(to right, rgba(0,255,0,0), rgba(0,255,102,0.8), rgba(0,255,0,0));
    box-shadow:0 0 30px rgba(0,255,102,0.9);
    animation:scan 4s linear infinite;
    pointer-events:none;
    z-index:9999;
}
@keyframes scan{
    0%{top:-4px;}
    100%{top:100%;}
}
.container{
    position:relative;
    z-index:1;
    background:rgba(0,15,7,0.98);
    padding:40px;
    border:3px solid #00ff66;
    box-shadow:0 0 60px rgba(0,255,102,0.5),
                inset 0 0 30px rgba(0,255,102,0.1);
    width:1000px;
    max-height:98vh;
    overflow-y:auto;
}
h2{
    text-align:center;
    margin-bottom:30px;
    letter-spacing:6px;
    text-shadow:0 0 15px #00ff66,
                0 0 30px #00ff66;
    font-size:32px;
}
.subtitle{
    text-align:center;
    color:#00ffaa;
    margin-bottom:40px;
    font-size:14px;
    opacity:0.8;
}
.instructions{
    background:rgba(0,25,12,0.7);
    padding:20px;
    border:1px solid #00ff66;
    margin-bottom:40px;
    line-height:1.8;
    font-size:15px;
}
.cipher-section{
    margin-bottom:45px;
    border:2px solid rgba(0,255,102,0.5);
    padding:25px;
    background:rgba(0,20,10,0.4);
    position:relative;
}
.section-title{
    color:#00ffaa;
    margin-bottom:20px;
    font-size:20px;
    text-align:center;
    padding-bottom:10px;
    border-bottom:1px solid rgba(0,255,102,0.3);
}
.cipher-type{
    font-size:12px;
    color:#00ff99;
    text-align:center;
    margin-bottom:15px;
    opacity:0.7;
}
.encoded-display{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    margin-bottom:25px;
    justify-content:center;
    padding:20px;
    background:rgba(0,0,0,0.3);
    border:1px solid rgba(0,255,102,0.2);
}
.cipher-cell{
    width:38px;
    height:48px;
    border:1px solid #00ff66;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:20px;
    background:rgba(0,10,5,0.8);
}
.cipher-cell.decrypted{
    color:#00ffff;
    font-weight:bold;
    background:rgba(0,30,15,0.8);
    border-color:#00ffff;
}
.space-cell{
    width:30px;
    border:none;
    background:transparent;
}
.decoder-interface{
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(120px, 1fr));
    gap:15px;
    margin-bottom:25px;
}
.cipher-map{
    display:flex;
    align-items:center;
    justify-content:space-between;
    border:1px solid #00ff66;
    padding:12px;
    background:rgba(0,0,0,0.5);
}
.cipher-map input{
    width:40px;
    height:40px;
    text-align:center;
    background:black;
    color:#00ff66;
    border:2px solid #00ff66;
    font-family:inherit;
    font-size:18px;
    font-weight:bold;
}
.cipher-map span{
    color:#00ffaa;
}
.button-container{
    text-align:center;
    margin-top:40px;
    padding-top:30px;
    border-top:1px solid rgba(0,255,102,0.3);
}
button{
    background:linear-gradient(to bottom, #002211, #000000);
    color:#00ff66;
    border:2px solid #00ff66;
    padding:18px 36px;
    cursor:pointer;
    margin:15px;
    font-family:inherit;
    font-size:16px;
    font-weight:bold;
    letter-spacing:2px;
    transition:all 0.3s;
}
button:hover{
    background:linear-gradient(to bottom, #00ff66, #002211);
    color:#000;
    box-shadow:0 0 30px rgba(0,255,102,0.7);
    transform:scale(1.05);
}
.result-output{
    text-align:center;
    margin-top:30px;
    min-height:60px;
    padding:20px;
    border:2px solid rgba(0,255,102,0.5);
    background:rgba(0,20,10,0.3);
    font-size:16px;
}
.final-layer{
    display:none;
    margin-top:50px;
    text-align:center;
    border:3px solid #00ffff;
    padding:30px;
    background:rgba(0,15,20,0.6);
    box-shadow:0 0 50px rgba(0,255,255,0.3);
}
.final-title{
    color:#00ffff;
    font-size:24px;
    margin-bottom:25px;
    text-shadow:0 0 10px #00ffff;
}
.final-cipher{
    font-size:28px;
    letter-spacing:8px;
    color:#00ff66;
    margin:30px 0;
    padding:25px;
    background:rgba(0,0,0,0.7);
    border:2px solid #00ff66;
}
.final-input{
    width:500px;
    padding:20px;
    background:black;
    color:#00ffff;
    border:3px solid #00ffff;
    text-align:center;
    font-family:inherit;
    font-size:20px;
    margin:30px 0;
    letter-spacing:2px;
}
.final-result{
    min-height:50px;
    padding:20px;
    margin-top:30px;
    font-size:18px;
}
.matrix-overlay{
    position:fixed;
    inset:0;
    pointer-events:none;
    opacity:0.1;
    background-image:
        repeating-linear-gradient(
            0deg,
            transparent,
            transparent 1px,
            rgba(0,255,102,0.1) 1px,
            rgba(0,255,102,0.1) 2px
        );
}
.back-button{
    position:fixed;
    top:20px;
    left:20px;
    background:rgba(0,20,10,0.8);
    color:#00ff66;
    border:1px solid #00ff66;
    padding:10px 20px;
    cursor:pointer;
    font-family:inherit;
    font-size:14px;
    z-index:10;
}
.back-button:hover{
    background:rgba(0,255,102,0.2);
}
</style>
</head>
<body>
<div class="grid-bg"></div>
<div class="scanner"></div>
<div class="matrix-overlay"></div>
<button class="back-button" onclick="goBack()">← BACK TO MENU</button>

<div class="container">
<h2>CYBERSECURITY ENCRYPTION BREAK</h2>
<div class="subtitle">FOUR-LAYER CIPHER DECRYPTION CHALLENGE</div>

<div class="instructions">
<p>Four distinct encryption systems have been intercepted. Each uses a different type of shift cipher: Caesar with varying shifts, Vigenere with complex keys, Atbash mirror encryption, and ROT13 with position modifiers.</p>
<p>Decrypt all four layers to reveal the master key pattern. Each correct decryption brings you closer to the final solution.</p>
</div>

<div id="cipherLayers"></div>

<div class="button-container">
<button onclick="validateAllLayers()">EXECUTE DECRYPTION SEQUENCE</button>
<button onclick="resetSystem()">INITIALIZE SYSTEM RESET</button>
</div>

<div class="result-output" id="result">
Initializing cryptographic analysis protocols...
</div>

<div class="final-layer" id="finalLayer">
<div class="final-title">FINAL DECRYPTION PHASE</div>
<p>Apply the master key pattern to decrypt the ultimate message:</p>
<div class="final-cipher" id="ultimateCipher">
XLI WXVMGER XS MR JSVQEXMSR
</div>
<input class="final-input" id="finalSolution" placeholder="ENTER DECRYPTED MESSAGE">
<button onclick="attemptFinalBreach()">EXECUTE FINAL DECRYPTION</button>
<div class="final-result" id="finalOutcome"></div>
</div>
</div>

<script>
// Back button function
function goBack() {
    window.location.href = "index.html";
}

const cipherSystems = [
    {
        name: "VARIABLE CAESAR SHIFT",
        type: "Caesar Cipher - Position-based shift: +4, +1, +8, +15, +16, +23",
        text: "DATA ENCRYPTION STANDARD IMPLEMENTATION",
        transform: function(text) {
            let result = "";
            const shifts = [4, 1, 8, 15, 16, 23];
            for(let i=0;i<text.length;i++){
                let char = text[i];
                if(char>='A'&&char<='Z'){
                    let shift = shifts[i % shifts.length];
                    let base = char.charCodeAt(0)-65;
                    let shifted = (base + shift) % 26;
                    result += String.fromCharCode(65 + shifted);
                }else{
                    result += char;
                }
            }
            return result;
        }
    },
    {
        name: "COMPLEX VIGENERE CIPHER",
        type: "Vigenere Cipher - Key: 'SECURITY' with alternating direction",
        text: "ADVANCED THREAT PROTECTION FRAMEWORK",
        transform: function(text) {
            let result = "";
            const key = "SECURITY";
            for(let i=0;i<text.length;i++){
                let char = text[i];
                if(char>='A'&&char<='Z'){
                    let keyChar = key[i % key.length];
                    let charIdx = char.charCodeAt(0)-65;
                    let keyIdx = keyChar.charCodeAt(0)-65;
                    let direction = i % 2 === 0 ? 1 : -1;
                    let shifted = (charIdx + (keyIdx * direction) + 26) % 26;
                    result += String.fromCharCode(65 + shifted);
                }else{
                    result += char;
                }
            }
            return result;
        }
    },
    {
        name: "ATBASH MIRROR CIPHER",
        type: "Atbash Cipher - Alphabet reversal: A↔Z, B↔Y, C↔X, etc.",
        text: "ZERO TRUST NETWORK ACCESS ARCHITECTURE",
        transform: function(text) {
            let result = "";
            for(let i=0;i<text.length;i++){
                let char = text[i];
                if(char>='A'&&char<='Z'){
                    let base = char.charCodeAt(0)-65;
                    let mirrored = 25 - base;
                    result += String.fromCharCode(65 + mirrored);
                }else{
                    result += char;
                }
            }
            return result;
        }
    },
    {
        name: "MODIFIED ROT13 CIPHER",
        type: "ROT13 with position-based extra rotation: +13 + (position % 3)",
        text: "MULTIFACTOR AUTHENTICATION PROTOCOLS",
        transform: function(text) {
            let result = "";
            for(let i=0;i<text.length;i++){
                let char = text[i];
                if(char>='A'&&char<='Z'){
                    let base = char.charCodeAt(0)-65;
                    let extra = i % 3;
                    let shifted = (base + 13 + extra) % 26;
                    result += String.fromCharCode(65 + shifted);
                }else{
                    result += char;
                }
            }
            return result;
        }
    }
];

const ultimateCipher = "XLI WXVMGER XS MR JSVQEXMSR";
const finalAnswer = "THE SECURITY IS IN ENCRYPTION";

let userDecryptions = cipherSystems.map(()=>({}));

function initializeCipherLayers(){
    const container = document.getElementById("cipherLayers");
    container.innerHTML = "";
    
    cipherSystems.forEach((cipher, index)=>{
        const section = document.createElement("div");
        section.className = "cipher-section";
        
        const title = document.createElement("div");
        title.className = "section-title";
        title.textContent = `${index+1}. ${cipher.name}`;
        section.appendChild(title);
        
        const type = document.createElement("div");
        type.className = "cipher-type";
        type.textContent = cipher.type;
        section.appendChild(type);
        
        const display = document.createElement("div");
        display.className = "encoded-display";
        
        let encrypted = cipher.transform(cipher.text);
        
        encrypted.split('').forEach((char, pos)=>{
            const cell = document.createElement("div");
            if(char === ' '){
                cell.className = "cipher-cell space-cell";
            }else{
                cell.className = "cipher-cell";
                cell.textContent = char;
                cell.dataset.layer = index;
                cell.dataset.pos = pos;
                cell.dataset.encrypted = char;
            }
            display.appendChild(cell);
        });
        section.appendChild(display);
        
        const decoder = document.createElement("div");
        decoder.className = "decoder-interface";
        
        const unique = [...new Set(encrypted.replace(/[^A-Z]/g,""))].sort();
        unique.forEach(letter=>{
            const map = document.createElement("div");
            map.className = "cipher-map";
            map.innerHTML = `
                <strong style="color:#00ffaa">${letter}</strong>
                <span>→</span>
                <input type="text" maxlength="1" 
                       data-layer="${index}" 
                       data-enc="${letter}"
                       oninput="updateDecryption(this)">
            `;
            decoder.appendChild(map);
        });
        section.appendChild(decoder);
        
        container.appendChild(section);
    });
}

function updateDecryption(input){
    const layer = parseInt(input.dataset.layer);
    const enc = input.dataset.enc;
    const val = input.value.toUpperCase().replace(/[^A-Z]/g,'');
    input.value = val;
    userDecryptions[layer][enc] = val;
    updateCipherDisplay();
}

function updateCipherDisplay(){
    document.querySelectorAll(".cipher-cell").forEach(cell=>{
        if(cell.dataset.layer && cell.dataset.encrypted){
            const layer = parseInt(cell.dataset.layer);
            const enc = cell.dataset.encrypted;
            const guess = userDecryptions[layer][enc];
            if(guess){
                cell.textContent = guess;
                cell.style.color = "#00ffff";
                cell.style.fontWeight = "bold";
                cell.classList.add("decrypted");
            }
        }
    });
}

function validateAllLayers(){
    let allValid = true;
    let status = "";
    
    cipherSystems.forEach((cipher, index)=>{
        let encrypted = cipher.transform(cipher.text);
        
        for(let i=0;i<encrypted.length;i++){
            const enc = encrypted[i];
            if(enc>='A'&&enc<='Z'){
                const original = cipher.text[i];
                const guess = userDecryptions[index][enc];
                if(!guess || guess !== original){
                    allValid = false;
                    status += `Layer ${index+1}: FAILED | `;
                    break;
                }
            }
        }
        if(allValid) status += `Layer ${index+1}: ✓ | `;
    });
    
    if(allValid){
        document.getElementById("result").innerHTML = 
            `<span style="color:#00ff66">✓ ALL FOUR CIPHERS DECRYPTED</span><br>
             Master key pattern established. Final layer activated.`;
        document.getElementById("finalLayer").style.display = "block";
    }else{
        document.getElementById("result").innerHTML = 
            `<span style="color:#ff0066"> DECRYPTION SEQUENCE FAILED</span><br>
             ${status}`;
    }
}

function attemptFinalBreach(){
    const input = document.getElementById("finalSolution").value.trim().toUpperCase();
    if(input === finalAnswer){
        document.getElementById("finalOutcome").innerHTML = 
            `<span style="color:#00ff66;font-size:24px;">
             Last 2 letters 84<br>
             FINAL DECRYPTION: "THE SECURITY IS IN ENCRYPTION "
             </span>`;
    }else{
        document.getElementById("finalOutcome").innerHTML = 
            `<span style="color:#ff0066">✗ BREACH ATTEMPT FAILED</span><br>
             Invalid decryption pattern detected.`;
    }
}

function resetSystem(){
    userDecryptions = cipherSystems.map(()=>({}));
    document.querySelectorAll("input").forEach(input=>input.value="");
    document.querySelectorAll(".cipher-cell").forEach(cell=>{
        if(cell.dataset.encrypted){
            cell.textContent = cell.dataset.encrypted;
            cell.style.color = "";
            cell.style.fontWeight = "";
            cell.classList.remove("decrypted");
        }
    });
    document.getElementById("finalLayer").style.display = "none";
    document.getElementById("result").textContent = "System reset. Ready for cryptographic analysis.";
    document.getElementById("finalOutcome").innerHTML = "";
    document.getElementById("finalSolution").value = "";
}

window.onload = initializeCipherLayers;
</script>
</body>
</html>